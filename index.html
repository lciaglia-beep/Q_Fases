<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lumina AI - Ads UGC con D3.js</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #FFFFFF; }
        
        /* --- ESTILOS DE TRANSICIÓN Y UI --- */
        .fade-enter { animation: fadeEnter 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeEnter { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-exit { animation: fadeExit 0.4s ease-in forwards; }
        @keyframes fadeExit { from { opacity: 1; } to { opacity: 0; pointer-events: none; } }

        /* Grid animado del Home (Estilo Arcads) */
        .marquee-container { overflow: hidden; white-space: nowrap; position: relative; }
        .marquee-content { display: inline-flex; animation: scroll 40s linear infinite; }
        .marquee-content:hover { animation-play-state: paused; }
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

        /* Estilos App (v2) */
        .avatar-select.active { ring: 2px solid #000; ring-offset: 2px; transform: scale(0.96); }
        .loader-ring { display: inline-block; width: 16px; height: 16px; border: 2px solid #fff; border-right-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        
        /* Utilidades */
        .glass-nav { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(0,0,0,0.05); }
        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* Estilos específicos para el gráfico D3 */
        .chart-container {
            position: relative;
            background: #111827; /* Fondo oscuro para contraste */
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
        }
        .line {
            fill: none;
            stroke-width: 3px;
        }
        .roas-line { stroke: #10B981; } /* Color verde para ROAS */
        .ctr-line { stroke: #3B82F6; } /* Color azul para CTR */
        .axis text { font-size: 10px; fill: #6B7280; }
        .axis line, .axis path { stroke: #374151; }
        .grid line { stroke: #374151; stroke-opacity: 0.5; }
        .tooltip {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 12px;
            border-radius: 8px;
            pointer-events: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            color: #1F2937;
            font-size: 12px;
            opacity: 0;
            transition: opacity 0.2s, transform 0.2s;
            z-index: 10;
        }
    </style>
</head>
<body class="text-slate-900 h-screen flex flex-col overflow-hidden">

    <!-- Navbar Fijo -->
    <nav class="glass-nav w-full h-16 flex items-center justify-between px-6 z-50 fixed top-0 left-0 transition-all duration-300" id="navbar">
        <div class="flex items-center gap-2 cursor-pointer" onclick="goHome()">
            <div class="w-8 h-8 bg-black rounded-lg flex items-center justify-center text-white font-bold shadow-md">L</div>
            <span class="font-bold text-lg tracking-tight">Lumina</span>
        </div>
        
        <!-- Enlaces de navegación -->
        <div id="nav-links" class="hidden md:flex items-center gap-8 text-sm font-medium text-slate-500">
            <a href="#" class="hover:text-black transition-colors">Casos de Éxito</a>
            <a href="#" class="hover:text-black transition-colors">Precios</a>
            <a href="#" class="hover:text-black transition-colors">Para Agencias</a>
        </div>

        <!-- Botones de Acción -->
        <div class="flex items-center gap-3">
            <button id="auth-button" onclick="showAuthModal()" class="text-sm font-medium text-slate-600 hover:text-black px-3 py-2 rounded-full transition-colors">
                Login / Registro
            </button>
            <button onclick="enterApp()" class="bg-black text-white text-sm font-medium px-5 py-2.5 rounded-full hover:scale-105 transition-transform shadow-lg shadow-slate-200">
                Crear Video Gratis
            </button>
        </div>
    </nav>

    <!-- Sección de Landing Page (Scrollable) -->
    <section id="landing-page" class="flex-1 pt-16 overflow-y-auto bg-white relative">
        <!-- Hero Section -->
        <div class="max-w-5xl mx-auto px-6 pt-16 pb-12 text-center fade-enter">
            <div class="inline-flex items-center gap-2 bg-slate-50 border border-slate-200 rounded-full px-3 py-1 mb-8">
                <span class="flex h-2 w-2 relative">
                    <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                    <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                </span>
                <span class="text-xs font-semibold text-slate-500 uppercase tracking-wide">Nuevo: Veo2 Integration</span>
            </div>
            
            <h1 class="text-6xl md:text-7xl font-bold text-slate-900 mb-6 tracking-tight leading-[1.1]">
                Convierte texto en <br>
                <span class="text-transparent bg-clip-text bg-gradient-to-r from-slate-400 to-slate-600">actores reales.</span>
            </h1>
            
            <p class="text-xl text-slate-500 mb-10 max-w-2xl mx-auto font-light leading-relaxed">
                Deja de contratar actores y estudios. Genera anuncios UGC (User Generated Content) virales en segundos usando nuestra IA de última generación.
            </p>
            
            <div class="flex justify-center gap-4">
                <button onclick="enterApp()" class="group bg-black text-white px-8 py-4 rounded-2xl text-lg font-medium hover:bg-slate-800 transition-all shadow-xl shadow-slate-200 flex items-center gap-3">
                    <span>Comenzar a Crear</span>
                    <i class="fa-solid fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                </button>
                <button class="bg-white border border-slate-200 text-slate-700 px-8 py-4 rounded-2xl text-lg font-medium hover:bg-slate-50 transition-colors flex items-center gap-3">
                    <i class="fa-solid fa-play"></i> Ver Demo
                </button>
            </div>
        </div>

        <!-- Carrusel de Videos de Influencers (Actualizado con mejores imágenes) -->
        <div class="w-full py-12 overflow-hidden bg-slate-50/50 border-y border-slate-100">
            <div class="marquee-container">
                <div class="marquee-content gap-6 px-6">
                    <!-- Video 1: Belleza -->
                    <div class="w-64 aspect-[9/16] rounded-2xl overflow-hidden relative shadow-lg group cursor-pointer hover:-translate-y-2 transition-transform duration-300">
                        <img src="https://images.unsplash.com/photo-1621217640698-c70f1a917244?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w0NTQ3NDd8MHwxfHNlYXJjaHwxfHxpbmZsdWVuY2VyJTIwYmVhdXR5JTIwcHJvZHVjdHxlbnwwfHx8fDE3MTc0MTg0Njh8MA&ixlib=rb-4.0.3&q=80&w=500" onerror="this.onerror=null;this.src='https://placehold.co/500x889/F472B6/FFFFFF?text=Influencer+Belleza'" class="w-full h-full object-cover">
                        <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent">
                            <p class="text-white font-medium text-sm">Serum Anti-Edad (Review)</p>
                            <p class="text-white/70 text-xs">Voz: ElevenLabs, Estilo "Entusiasta"</p>
                        </div>
                    </div>
                     <!-- Video 2: Tecnología -->
                    <div class="w-64 aspect-[9/16] rounded-2xl overflow-hidden relative shadow-lg group cursor-pointer hover:-translate-y-2 transition-transform duration-300">
                        <img src="https://images.unsplash.com/photo-1621609764035-de241c0d4303?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w0NTQ3NDd8MHwxfHxpbmZsdWVuY2VyJTIwdGVjaCUyMHByb2R1Y3R8ZW58MHx8fHwxNzE3NDE4NjA3fDA&ixlib=rb-4.0.3&q=80&w=500" onerror="this.onerror=null;this.src='https://placehold.co/500x889/3B82F6/FFFFFF?text=Influencer+Tecnología'" class="w-full h-full object-cover">
                        <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent">
                            <p class="text-white font-medium text-sm">Unboxing: Smartwatch X</p>
                            <p class="text-white/70 text-xs">Avatar: Leo (Pro), Fondo: Creado con IA</p>
                        </div>
                    </div>
                    <!-- Video 3: Fitness -->
                    <div class="w-64 aspect-[9/16] rounded-2xl overflow-hidden relative shadow-lg group cursor-pointer hover:-translate-y-2 transition-transform duration-300">
                        <img src="https://images.unsplash.com/photo-1579758774780-f09689456569?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w0NTQ3NDd8MHwxfHNlYXJjaHwxfHxpbmZsdWVuY2VyJTIwZml0bmVzcyUyMHN1cHBsZW1lbnRzfGVufDB8fHx8MTcxNzQxODcyM3ww&ixlib=rb-4.0.3&q=80&w=500" onerror="this.onerror=null;this.src='https://placehold.co/500x889/10B981/FFFFFF?text=Influencer+Fitness'" class="w-full h-full object-cover">
                        <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent">
                            <p class="text-white font-medium text-sm">Mi Rutina + Proteína</p>
                            <p class="text-white/70 text-xs">Generado en 15s. Máximo CTR</p>
                        </div>
                    </div>
                    <!-- Video 4: Finanzas -->
                    <div class="w-64 aspect-[9/16] rounded-2xl overflow-hidden relative shadow-lg group cursor-pointer hover:-translate-y-2 transition-transform duration-300">
                        <img src="https://images.unsplash.com/photo-1558239062-817349195971?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w0NTQ3NDd8MHwxfHNlYXJjaHwxfHxpbmZsdWVuY2VyJTIwcHJvZHVjdCUyMHJldmlld3xlbnwwfHx8fDE3MTc0MTg1NTh8MA&ixlib=rb-4.0.3&q=80&w=500" onerror="this.onerror=null;this.src='https://placehold.co/500x889/F59E0B/FFFFFF?text=Influencer+Finanzas'" class="w-full h-full object-cover">
                        <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent">
                            <p class="text-white font-medium text-sm">Plataforma de Trading</p>
                            <p class="text-white/70 text-xs">Lip-Sync: Perfecto, Voz: Española</p>
                        </div>
                    </div>
                    
                    <div class="w-64 aspect-[9/16] bg-slate-200 rounded-2xl flex items-center justify-center">
                        <span class="text-slate-400 font-medium">Ver más ejemplos UGC...</span>
                    </div>
                    <!-- Duplicación para efecto carrusel infinito -->
                    <div class="w-64 aspect-[9/16] rounded-2xl overflow-hidden relative shadow-lg group cursor-pointer hover:-translate-y-2 transition-transform duration-300">
                        <img src="https://images.unsplash.com/photo-1621217640698-c70f1a917244?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w0NTQ3NDd8MHwxfHNlYXJjaHwxfHxpbmZsdWVuY2VyJTIwYmVhdXR5JTIwcHJvZHVjdHxlbnwwfHx8fDE3MTc0MTg0Njh8MA&ixlib=rb-4.0.3&q=80&w=500" onerror="this.onerror=null;this.src='https://placehold.co/500x889/F472B6/FFFFFF?text=Influencer+Belleza'" class="w-full h-full object-cover">
                        <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent">
                            <p class="text-white font-medium text-sm">Serum Anti-Edad (Review)</p>
                            <p class="text-white/70 text-xs">Voz: ElevenLabs, Estilo "Entusiasta"</p>
                        </div>
                    </div>
                     
                    <div class="w-64 aspect-[9/16] rounded-2xl overflow-hidden relative shadow-lg group cursor-pointer hover:-translate-y-2 transition-transform duration-300">
                        <img src="https://images.unsplash.com/photo-1621609764035-de241c0d4303?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w0NTQ3NDd8MHwxfHxpbmZsdWVuY2VyJTIwdGVjaCUyMHByb2R1Y3R8ZW58MHx8fHwxNzE3NDE4NjA3fDA&ixlib=rb-4.0.3&q=80&w=500" onerror="this.onerror=null;this.src='https://placehold.co/500x889/3B82F6/FFFFFF?text=Influencer+Tecnología'" class="w-full h-full object-cover">
                        <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent">
                            <p class="text-white font-medium text-sm">Unboxing: Smartwatch X</p>
                            <p class="text-white/70 text-xs">Avatar: Leo (Pro), Fondo: Creado con IA</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logos de Clientes -->
        <div class="py-12 text-center">
            <p class="text-sm text-slate-400 font-medium uppercase tracking-widest mb-6">Utilizado por los mejores growth hackers</p>
            <div class="flex justify-center items-center gap-12 opacity-40 grayscale">
                <i class="fa-brands fa-spotify text-3xl"></i>
                <i class="fa-brands fa-amazon text-3xl"></i>
                <i class="fa-brands fa-stripe text-3xl"></i>
                <i class="fa-brands fa-airbnb text-3xl"></i>
            </div>
        </div>

        <!-- NUEVA SECCIÓN: Resultados y Escalabilidad -->
        <div class="bg-black py-20">
            <div class="max-w-6xl mx-auto px-6 grid grid-cols-1 lg:grid-cols-2 gap-12">
                
                <!-- Columna 1: Agente IA y Logotipos (Inspirado en tu imagen) -->
                <div class="text-white p-8 rounded-3xl bg-slate-900 border border-slate-800 flex flex-col justify-between">
                    <div>
                        <h2 class="text-4xl font-bold mb-4 tracking-tight">
                            Crea tu propio <br>
                            <span class="text-transparent bg-clip-text bg-gradient-to-r from-blue-300 to-indigo-400 italic">Agente IA</span> para marketing
                        </h2>
                        <p class="text-slate-400 text-lg mb-8">
                            La mejor librería UGC de IA con más de 1,000 Actores IA y voces multilingües.
                        </p>
                        <button onclick="enterApp()" class="group bg-white text-black px-6 py-3 rounded-xl font-semibold hover:bg-slate-100 transition-colors flex items-center gap-2 text-sm">
                            <span>Crear tu Anuncio IA</span>
                            <i class="fa-solid fa-sparkles text-yellow-500"></i>
                        </button>
                    </div>

                    <!-- Grid de Logotipos de Integración -->
                    <div class="relative mt-12 flex justify-center items-center">
                        <div class="w-full h-full absolute flex items-center justify-center">
                            <!-- Logo central de Lumina (Arcade/Vidrio) -->
                            <div class="w-24 h-24 bg-white/30 backdrop-blur-md rounded-3xl flex items-center justify-center ring-4 ring-white/10 shadow-2xl z-10">
                                <span class="text-3xl font-extrabold text-black/80">L</span>
                            </div>
                        </div>
                        
                        <!-- Logotipos alrededor -->
                        <div class="grid grid-cols-3 grid-rows-2 gap-x-16 gap-y-12 w-full max-w-sm" style="transform: rotate(15deg);">
                            <div class="w-16 h-16 bg-black rounded-xl border border-slate-800 shadow-xl flex items-center justify-center" style="transform: rotate(-15deg) translateY(-10px) translateX(-5px);">
                                <i class="fa-brands fa-slack text-white text-2xl opacity-70"></i>
                            </div>
                            <div class="w-16 h-16 bg-black rounded-xl border border-slate-800 shadow-xl flex items-center justify-center" style="transform: rotate(-15deg);">
                                <img src="https://placehold.co/128x128/000000/FFFFFF?text=Arcade" alt="Arcade Logo" class="w-8 h-8 opacity-70">
                            </div>
                            <div class="w-16 h-16 bg-black rounded-xl border border-slate-800 shadow-xl flex items-center justify-center" style="transform: rotate(-15deg) translateY(10px) translateX(5px);">
                                <img src="https://placehold.co/128x128/000000/FFFFFF?text=ElevenLabs" alt="Eleven Labs Logo" class="w-10 h-10 opacity-70">
                            </div>
                            
                            <div class="w-16 h-16 bg-black rounded-xl border border-slate-800 shadow-xl flex items-center justify-center" style="transform: rotate(-15deg) translateY(5px) translateX(-10px);">
                                <i class="fa-brands fa-tiktok text-white text-2xl opacity-70"></i>
                            </div>
                            <div class="w-16 h-16 bg-black rounded-xl border border-slate-800 shadow-xl flex items-center justify-center" style="transform: rotate(-15deg);">
                                <i class="fa-solid fa-layer-group text-white text-2xl opacity-70"></i>
                            </div>
                            <div class="w-16 h-16 bg-black rounded-xl border border-slate-800 shadow-xl flex items-center justify-center" style="transform: rotate(-15deg) translateY(-5px) translateX(10px);">
                                <i class="fa-solid fa-code text-white text-2xl opacity-70"></i>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Columna 2: Gráfico de Resultados (D3.js) -->
                <div class="text-white p-8 rounded-3xl bg-slate-900 border border-slate-800">
                    <h2 class="text-3xl font-bold mb-2">
                        +50% ROAS, <br>
                        <span class="text-green-400">Resultados reales</span>
                    </h2>
                    <p class="text-slate-400 mb-6">
                        Análisis de campaña (Simulación UGC vs. Creativo Clásico).
                    </p>
                    
                    <div id="d3-chart-container" class="chart-container h-96">
                        <div id="tooltip" class="tooltip"></div>
                    </div>
                    
                    <div class="mt-6 flex justify-around text-sm font-medium">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-green-400"></div>
                            <span>ROAS (Lumina AI)</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 rounded-full bg-blue-400"></div>
                            <span>CTR (Lumina AI)</span>
                        </div>
                    </div>

                </div>

            </div>
        </div>
        <!-- Fin de NUEVA SECCIÓN -->

        <!-- Pie de página simple -->
        <footer class="py-10 text-center text-sm text-slate-500 border-t border-slate-100 mt-16">
            © 2025 Lumina AI. Todos los derechos reservados. | <a href="#" class="hover:underline">Privacidad</a>
        </footer>
    </section>

    <!-- Sección de Aplicación (Oculta) -->
    <section id="app-studio" class="hidden flex-1 pt-16 overflow-hidden bg-slate-50 relative">
        <aside class="w-80 bg-white border-r border-slate-200 flex flex-col z-20 shadow-[4px_0_24px_rgba(0,0,0,0.02)] absolute top-16 bottom-0 left-0">
            <div class="flex p-3 border-b border-slate-100 gap-2">
                <button onclick="setTab('library')" id="tab-lib" class="flex-1 bg-slate-100 text-black text-xs font-semibold py-2 rounded-lg transition-colors">Biblioteca</button>
                <button onclick="setTab('ai')" id="tab-ai" class="flex-1 text-slate-500 hover:bg-slate-50 text-xs font-semibold py-2 rounded-lg transition-colors flex items-center justify-center gap-1"><i class="fa-solid fa-wand-magic-sparkles"></i> Generar IA</button>
            </div>
            <div id="view-library" class="flex-1 p-4 overflow-y-auto">
                <div class="grid grid-cols-2 gap-3" id="avatar-grid"></div>
            </div>
            <div id="view-ai" class="hidden flex-1 p-4">
                <div class="bg-indigo-50 border border-indigo-100 rounded-xl p-4 mb-4">
                    <label class="text-[10px] font-bold text-indigo-400 uppercase tracking-widest">Prompt Creativo</label>
                    <textarea id="ai-prompt" class="w-full h-24 bg-white mt-2 p-3 rounded-lg border border-indigo-100 text-sm resize-none focus:outline-none focus:ring-2 focus:ring-indigo-500/20" placeholder="Describe tu avatar ideal..."></textarea>
                    <button onclick="simulateAIGen()" id="btn-ai-gen" class="w-full mt-3 bg-indigo-600 text-white py-2 rounded-lg text-xs font-medium hover:bg-indigo-700 transition-colors">
                        Generar Imagen
                    </button>
                </div>
                <div id="ai-result-area" class="grid grid-cols-2 gap-2"></div>
            </div>
        </aside>

        <main class="absolute top-16 bottom-0 left-80 right-96 bg-[#F4F4F5] flex flex-col">
            <div class="h-12 border-b border-slate-200 bg-white/50 backdrop-blur flex items-center justify-between px-4">
                <div class="flex gap-2">
                    <span class="text-[10px] font-mono text-slate-400">CANVAS: 1080x1920</span>
                </div>
                <div id="user-display" class="text-xs text-slate-500 font-medium"></div>
            </div>

            <div class="flex-1 flex items-center justify-center p-8 overflow-hidden">
                <div class="relative w-[340px] h-[600px] bg-black rounded-[2.5rem] shadow-2xl ring-4 ring-slate-300 overflow-hidden transition-all duration-500" id="phone-frame">
                    <img id="main-preview" src="https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=1000&auto=format&fit=crop" class="w-full h-full object-cover">
                    <video id="result-video" class="w-full h-full object-cover hidden" playsinline loop></video>

                    <div id="processing-overlay" class="absolute inset-0 bg-black/90 hidden flex-col items-center justify-center text-white z-50">
                        <div class="w-12 h-12 border-2 border-slate-700 border-t-white rounded-full animate-spin mb-4"></div>
                        <p class="text-sm font-medium animate-pulse" id="process-text">Iniciando...</p>
                        <p class="text-xs text-slate-500 mt-1 font-mono" id="process-detail">Connecting to API...</p>
                    </div>

                    <div id="play-btn-overlay" class="absolute inset-0 flex items-center justify-center bg-black/10 hover:bg-black/20 cursor-pointer hidden z-40" onclick="togglePlay()">
                        <div class="w-14 h-14 bg-white/30 backdrop-blur rounded-full flex items-center justify-center border border-white/60 transition-transform hover:scale-110">
                            <i class="fa-solid fa-play text-white text-xl ml-1"></i>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <aside class="w-96 bg-white border-l border-slate-200 flex flex-col z-20 shadow-[-4px_0_24px_rgba(0,0,0,0.02)] absolute top-16 bottom-0 right-0">
            <div class="flex-1 p-6 overflow-y-auto">
                <div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-xs font-bold text-slate-900">GUION</label>
                        <span class="text-[10px] text-slate-400 bg-slate-100 px-2 py-0.5 rounded">GPT-4o Ready</span>
                    </div>
                    <textarea id="script-input" class="w-full h-40 p-4 bg-slate-50 border border-slate-200 rounded-xl text-sm text-slate-800 focus:bg-white focus:ring-2 focus:ring-black/5 outline-none resize-none transition-all" placeholder="Hola, escribe aquí lo que quieres que diga tu avatar..."></textarea>
                </div>
                <div class="mb-8">
                    <label class="text-xs font-bold text-slate-900 block mb-2">VOZ (ELEVENLABS)</label>
                    <div class="space-y-2">
                        <!-- Ejemplo de voz seleccionada -->
                        <div class="flex items-center justify-between p-3 border border-black bg-slate-50 rounded-xl cursor-pointer">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-gradient-to-br from-blue-100 to-indigo-100 flex items-center justify-center text-indigo-600 text-xs border border-indigo-50">
                                    <i class="fa-solid fa-wave-square"></i>
                                </div>
                                <div>
                                    <div class="text-sm font-semibold">Rachel (Narrativa)</div>
                                    <div class="text-[10px] text-slate-500">Inglés, US, Calmada</div>
                                </div>
                            </div>
                            <i class="fa-solid fa-circle-check text-black"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="p-6 border-t border-slate-100 bg-white">
                <button onclick="generateFinalVideo()" id="btn-generate" class="w-full bg-black text-white py-4 rounded-xl font-medium hover:bg-slate-800 transition-all shadow-xl shadow-slate-200 flex items-center justify-center gap-2">
                    <span>Generar Video (2 Créditos)</span>
                    <i class="fa-solid fa-bolt text-yellow-300"></i>
                </button>
            </div>
        </aside>
    </section>

    <!-- Modal de Autenticación -->
    <div id="auth-modal" class="fixed inset-0 bg-black/50 z-[100] hidden items-center justify-center transition-opacity duration-300">
        <div class="bg-white p-8 rounded-xl w-full max-w-md shadow-2xl scale-95 transition-transform duration-300" id="auth-box">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold" id="auth-title">Inicia Sesión</h2>
                <button onclick="hideAuthModal()" class="text-slate-400 hover:text-black transition-colors"><i class="fa-solid fa-times"></i></button>
            </div>
            
            <input type="email" id="auth-email" class="w-full p-3 mb-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-black/5 outline-none" placeholder="Email">
            <input type="password" id="auth-password" class="w-full p-3 mb-4 border border-slate-300 rounded-lg focus:ring-2 focus:ring-black/5 outline-none" placeholder="Contraseña">
            
            <p id="auth-error" class="text-red-500 text-xs mb-3 hidden"></p>

            <button onclick="handleEmailAuth()" id="btn-email-auth" class="w-full bg-black text-white py-3 rounded-lg text-sm font-medium hover:bg-slate-800 transition-colors">
                Iniciar Sesión
            </button>
            
            <p class="text-center mt-4 text-sm">
                <a href="#" onclick="toggleAuthMode(event)" id="toggle-auth-link" class="text-slate-500 hover:underline">
                    ¿No tienes cuenta? Regístrate
                </a>
            </p>
        </div>
    </div>


    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            signInWithCustomToken, 
            onAuthStateChanged,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            signOut
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        
        // --- FIREBASE SETUP ---
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        // --- GLOBAL STATE ---
        let authReady = false;
        let currentUser = null;
        let authMode = 'login'; // 'login' or 'signup'
        let currentTab = 'library';

        // --- MOCK DATA ---
        const avatars = [
            { id: 1, img: "https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?q=80&w=500&auto=format&fit=crop", name: "Sofia", selected: true },
            { id: 2, img: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?q=80&w=500&auto=format&fit=crop", name: "Maya", selected: false },
            { id: 3, img: "https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?q=80&w=500&auto=format&fit=crop", name: "Leo", selected: false },
            { id: 4, img: "https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?q=80&w=500&auto=format&fit=crop", name: "Elena", selected: false }
        ];

        // --- AUTHENTICATION FLOW ---

        async function initializeAuth() {
            try {
                const token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                if (token) {
                    await signInWithCustomToken(auth, token);
                } else {
                    if (!auth.currentUser) {
                        await signInAnonymously(auth);
                    }
                }
            } catch (error) {
                console.error("Error during initial sign-in:", error);
                try {
                    if (!auth.currentUser) await signInAnonymously(auth);
                } catch (e) {
                    console.error("Error signing in anonymously:", e);
                }
            }
        }
        
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            authReady = true;

            const authBtn = document.getElementById('auth-button');
            const userDisplay = document.getElementById('user-display');
            
            if (user && user.email) {
                const email = user.email;
                authBtn.innerHTML = `<i class="fa-solid fa-user-circle mr-1"></i> ${email.split('@')[0]}`;
                authBtn.onclick = () => showLogoutOptions();
                
                userDisplay.innerHTML = `Usuario: <span class="text-black">${user.uid.substring(0, 8)}...</span>`;

            } else {
                authBtn.innerHTML = `Login / Registro`;
                authBtn.onclick = showAuthModal;
                userDisplay.innerHTML = '';
            }

            console.log("Auth state changed. User:", user ? (user.email || 'Anonymous') : "None");
        });

        // --- AUTH MODAL HANDLERS ---
        window.showAuthModal = function() {
            document.getElementById('auth-modal').classList.add('flex');
            document.getElementById('auth-modal').classList.remove('hidden');
            document.getElementById('auth-box').classList.remove('scale-95');
        }

        window.hideAuthModal = function() {
            document.getElementById('auth-modal').classList.add('hidden');
            document.getElementById('auth-modal').classList.remove('flex');
            document.getElementById('auth-box').classList.add('scale-95');
            document.getElementById('auth-error').classList.add('hidden');
        }

        function showError(message) {
            const errorEl = document.getElementById('auth-error');
            errorEl.innerText = message;
            errorEl.classList.remove('hidden');
        }

        window.toggleAuthMode = function(e) {
            e.preventDefault();
            authMode = authMode === 'login' ? 'signup' : 'login';
            const title = document.getElementById('auth-title');
            const btn = document.getElementById('btn-email-auth');
            const link = document.getElementById('toggle-auth-link');
            document.getElementById('auth-error').classList.add('hidden');

            if (authMode === 'signup') {
                title.innerText = 'Regístrate';
                btn.innerText = 'Crear Cuenta';
                link.innerHTML = '¿Ya tienes cuenta? Inicia Sesión';
            } else {
                title.innerText = 'Inicia Sesión';
                btn.innerText = 'Iniciar Sesión';
                link.innerHTML = '¿No tienes cuenta? Regístrate';
            }
        }

        window.handleEmailAuth = async function() {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-password').value;
            document.getElementById('auth-error').classList.add('hidden');

            if (!email || !password) {
                return showError("Por favor, introduce email y contraseña.");
            }

            try {
                if (authMode === 'signup') {
                    await createUserWithEmailAndPassword(auth, email, password);
                } else {
                    await signInWithEmailAndPassword(auth, email, password);
                }
                hideAuthModal();
            } catch (error) {
                console.error(error);
                let message = "Error de autenticación. Inténtalo de nuevo.";
                if (error.code === 'auth/email-already-in-use') {
                    message = "El email ya está registrado. ¿Quieres iniciar sesión?";
                } else if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                    message = "Email o contraseña incorrectos.";
                } else if (error.code === 'auth/weak-password') {
                    message = "La contraseña debe tener al menos 6 caracteres.";
                }
                showError(message);
            }
        }

        // --- LOGOUT (Simple alert replacement) ---
        function showLogoutOptions() {
            const modal = document.getElementById('auth-modal');
            const box = document.getElementById('auth-box');
            
            box.innerHTML = `
                <h2 class="text-xl font-bold mb-4">Opciones de Usuario</h2>
                <p class="mb-6 text-slate-600">Sesión iniciada como: ${currentUser.email || 'Anónimo'}</p>
                <button onclick="logoutUser()" class="w-full mb-3 py-3 bg-red-600 text-white rounded-lg text-sm font-medium hover:bg-red-700 transition-colors">
                    Cerrar Sesión
                </button>
                <button onclick="hideAuthModal()" class="w-full py-3 border border-slate-300 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors">
                    Volver
                </button>
            `;
            modal.classList.add('flex');
            modal.classList.remove('hidden');
        }

        window.logoutUser = async function() {
            try {
                await signOut(auth);
                hideAuthModal();
                goHome();
            } catch (error) {
                console.error("Error al cerrar sesión:", error);
            }
        }


        // --- NAVIGATION LOGIC (AJUSTADO PARA ROBUSTEZ) ---
        window.goHome = function() {
            try {
                const landing = document.getElementById('landing-page');
                const app = document.getElementById('app-studio');
                const navbarLinks = document.getElementById('nav-links');
                
                app.classList.add('hidden');
                app.classList.remove('flex');
                
                // Mostrar la landing page
                landing.style.display = 'block';
                landing.classList.remove('fade-exit');
                landing.classList.add('fade-enter');

                navbarLinks.style.opacity = '1';
            } catch (error) {
                console.error("Error en goHome:", error);
            }
        }

        window.enterApp = function() {
            const landing = document.getElementById('landing-page');
            const app = document.getElementById('app-studio');
            const navbarLinks = document.getElementById('nav-links');
            
            // 1. Iniciar la animación de salida
            landing.classList.add('fade-exit');
            navbarLinks.style.opacity = '0';
            
            // 2. Esperar un poco más de tiempo para que la animación se complete
            setTimeout(() => {
                try {
                    // Ocultar la landing page de forma permanente
                    landing.style.display = 'none';
                    landing.classList.remove('fade-exit'); // Limpiar la clase de animación

                    // Mostrar y animar la sección de la aplicación
                    app.classList.remove('hidden');
                    app.classList.add('flex', 'fade-enter'); // 'flex' es crucial para el layout
                    
                    // Asegurar que se renderizan los avatares
                    renderAvatars(); 

                    navbarLinks.style.opacity = '1';
                } catch (error) {
                    // En caso de error, al menos intenta mostrar la app sin animación
                    console.error("Error en la transición enterApp (Timeout):", error);
                    landing.style.display = 'none';
                    app.classList.remove('hidden');
                    app.classList.add('flex');
                }
            }, 400); // Aumentado a 400ms para mayor fiabilidad
        }

        // --- APP STUDIO LOGIC ---

        function renderAvatars() {
            const grid = document.getElementById('avatar-grid');
            if (!grid) return; // Guard clause for robustness
            grid.innerHTML = '';
            
            avatars.forEach(avatar => {
                const div = document.createElement('div');
                div.className = `avatar-select w-full aspect-[4/5] rounded-xl overflow-hidden relative group cursor-pointer border-2 border-transparent transition-all duration-200 ${avatar.selected ? 'active border-black' : ''}`;
                div.onclick = () => selectAvatar(avatar.id);
                
                div.innerHTML = `
                    <img src="${avatar.img}" class="w-full h-full object-cover">
                    <div class="absolute inset-0 bg-black/20 group-hover:bg-black/10 transition-colors"></div>
                    <div class="absolute bottom-2 left-2 text-white text-xs font-semibold bg-black/60 px-2 py-0.5 rounded">${avatar.name}</div>
                `;
                grid.appendChild(div);
            });
        }

        window.selectAvatar = function(id) {
            avatars.forEach(a => a.selected = a.id === id);
            renderAvatars();
            
            // Actualizar la vista previa principal
            const selectedAvatar = avatars.find(a => a.id === id);
            if (selectedAvatar) {
                document.getElementById('main-preview').src = selectedAvatar.img;
            }
        }

        window.setTab = function(tab) {
            currentTab = tab;
            document.getElementById('tab-lib').classList.remove('bg-slate-100', 'text-black');
            document.getElementById('tab-lib').classList.add('text-slate-500', 'hover:bg-slate-50');
            document.getElementById('tab-ai').classList.remove('bg-slate-100', 'text-black');
            document.getElementById('tab-ai').classList.add('text-slate-500', 'hover:bg-slate-50');

            if (tab === 'library') {
                document.getElementById('tab-lib').classList.add('bg-slate-100', 'text-black');
                document.getElementById('tab-lib').classList.remove('text-slate-500', 'hover:bg-slate-50');
                document.getElementById('view-library').classList.remove('hidden');
                document.getElementById('view-ai').classList.add('hidden');
            } else {
                document.getElementById('tab-ai').classList.add('bg-slate-100', 'text-black');
                document.getElementById('tab-ai').classList.remove('text-slate-500', 'hover:bg-slate-50');
                document.getElementById('view-library').classList.add('hidden');
                document.getElementById('view-ai').classList.remove('hidden');
            }
        }

        // Simulación de generación de video
        window.generateFinalVideo = function() {
            const script = document.getElementById('script-input').value.trim();
            if (!script) {
                showSimpleMessage("Error", "El guion no puede estar vacío.", "red");
                return;
            }

            const overlay = document.getElementById('processing-overlay');
            const mainPreview = document.getElementById('main-preview');
            const resultVideo = document.getElementById('result-video');
            const processText = document.getElementById('process-text');
            const processDetail = document.getElementById('process-detail');
            const btnGenerate = document.getElementById('btn-generate');
            
            btnGenerate.disabled = true;
            btnGenerate.innerHTML = '<span class="loader-ring mr-2"></span> Generando...';

            mainPreview.classList.add('hidden');
            resultVideo.classList.add('hidden');
            resultVideo.pause();
            overlay.classList.remove('hidden');
            document.getElementById('play-btn-overlay').classList.add('hidden');


            // Simular pasos de generación
            const steps = [
                { text: "Analizando guion y seleccionando voz...", detail: "Text-to-Speech (ElevenLabs)" },
                { text: "Creando animación facial (Lip-Sync)...", detail: "Modelo de sincronización de movimiento" },
                { text: "Renderizando video final...", detail: "GPU Cloud Render Farm" },
            ];

            let stepIndex = 0;
            const interval = setInterval(() => {
                if (stepIndex < steps.length) {
                    processText.innerText = steps[stepIndex].text;
                    processDetail.innerText = steps[stepIndex].detail;
                    stepIndex++;
                } else {
                    clearInterval(interval);
                    
                    // Finalizar y mostrar el video simulado
                    overlay.classList.add('hidden');
                    
                    // Usar un video de muestra (simulado)
                    resultVideo.src = 'https://www.w3schools.com/html/mov_bbb.mp4';
                    resultVideo.classList.remove('hidden');
                    resultVideo.play();
                    document.getElementById('play-btn-overlay').classList.remove('hidden');


                    btnGenerate.disabled = false;
                    btnGenerate.innerHTML = '<span>Generar Video (2 Créditos)</span> <i class="fa-solid fa-bolt text-yellow-300"></i>';
                    
                    showSimpleMessage("¡Video Listo!", "Tu video UGC con Avatar IA se ha generado correctamente.", "green");
                }
            }, 2000);
        }

        window.togglePlay = function() {
            const video = document.getElementById('result-video');
            const playIcon = document.querySelector('#play-btn-overlay i');
            
            if (video.paused) {
                video.play();
                playIcon.classList.remove('fa-play');
                playIcon.classList.add('fa-pause');
            } else {
                video.pause();
                playIcon.classList.remove('fa-pause');
                playIcon.classList.add('fa-play');
            }
        }


        // Simulación de generación de imagen (AI Tab)
        window.simulateAIGen = function() {
            const prompt = document.getElementById('ai-prompt').value.trim();
            const btn = document.getElementById('btn-ai-gen');
            const resultArea = document.getElementById('ai-result-area');
            
            if (!prompt) {
                 showSimpleMessage("Error", "El prompt no puede estar vacío.", "red");
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<span class="loader-ring mr-2 bg-black"></span> Generando...';
            resultArea.innerHTML = '<p class="text-sm text-slate-500 mt-4 col-span-2 text-center">Generando 4 opciones de avatar...</p>';

            setTimeout(() => {
                btn.disabled = false;
                btn.innerHTML = 'Generar Imagen';
                
                // Imágenes simuladas de avatares IA
                const results = [
                    { id: 10, img: "https://placehold.co/128x160/2563EB/FFFFFF?text=AI+Result+1" },
                    { id: 11, img: "https://placehold.co/128x160/1D4ED8/FFFFFF?text=AI+Result+2" },
                    { id: 12, img: "https://placehold.co/128x160/1E3A8A/FFFFFF?text=AI+Result+3" },
                    { id: 13, img: "https://placehold.co/128x160/000000/FFFFFF?text=AI+Result+4" }
                ];

                resultArea.innerHTML = '';
                results.forEach(res => {
                    const div = document.createElement('div');
                    div.className = `w-full aspect-[4/5] rounded-xl overflow-hidden relative group cursor-pointer border-2 border-transparent transition-all duration-200 hover:border-black`;
                    div.onclick = () => showSimpleMessage("Avatar Creado", "Este avatar se ha añadido a tu librería. Selecciona para usar.", "blue");
                    
                    div.innerHTML = `
                        <img src="${res.img}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity">
                            <i class="fa-solid fa-check-circle text-white text-2xl"></i>
                        </div>
                    `;
                    resultArea.appendChild(div);
                });
                
            }, 3000);
        }

        // --- CUSTOM MESSAGE BOX ---
        function showSimpleMessage(title, message, type) {
            const modal = document.getElementById('auth-modal');
            const box = document.getElementById('auth-box');
            
            let color = 'bg-black';
            if (type === 'red') color = 'bg-red-600';
            if (type === 'green') color = 'bg-green-600';
            if (type === 'blue') color = 'bg-blue-600';

            box.innerHTML = `
                <div class="flex items-center gap-3 mb-4">
                    <div class="w-8 h-8 ${color} rounded-full flex items-center justify-center text-white">
                        <i class="fa-solid ${type === 'red' ? 'fa-exclamation' : type === 'green' ? 'fa-check' : 'fa-info'}"></i>
                    </div>
                    <h2 class="text-xl font-bold">${title}</h2>
                </div>
                <p class="mb-6 text-slate-600">${message}</p>
                <button onclick="hideAuthModal()" class="w-full py-3 border border-slate-300 rounded-lg text-sm font-medium hover:bg-slate-50 transition-colors">
                    Aceptar
                </button>
            `;
            // Re-utilizar el modal de auth para mostrar el mensaje
            modal.classList.add('flex');
            modal.classList.remove('hidden');
        }
        
        // --- D3 CHART LOGIC ---
        function createD3Chart() {
            const data = [
                { week: 1, roas: 1.5, ctr: 2.0, label: "Clásico" },
                { week: 2, roas: 1.6, ctr: 2.1, label: "Clásico" },
                { week: 3, roas: 1.8, ctr: 2.3, label: "Inicio UGC" },
                { week: 4, roas: 2.2, ctr: 2.8, label: "Escala UGC" },
                { week: 5, roas: 2.5, ctr: 3.2, label: "Optimización" },
                { week: 6, roas: 2.8, ctr: 3.5, label: "Virales" }
            ];

            const containerId = "#d3-chart-container";
            const margin = { top: 20, right: 20, bottom: 30, left: 35 };
            const containerEl = document.querySelector(containerId);
            if (!containerEl) return;

            const containerWidth = containerEl.clientWidth;
            const containerHeight = containerEl.clientHeight;
            const width = containerWidth - margin.left - margin.right;
            const height = containerHeight - margin.top - margin.bottom;

            // Eliminar cualquier SVG anterior
            d3.select(containerId).select("svg").remove();

            const svg = d3.select(containerId)
                .append("svg")
                .attr("width", containerWidth)
                .attr("height", containerHeight)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Escalas
            const x = d3.scaleBand()
                .domain(data.map(d => `Semana ${d.week}`))
                .range([0, width])
                .padding(1);

            const yRoas = d3.scaleLinear()
                .domain([1.0, d3.max(data, d => d.roas) * 1.1])
                .range([height, 0]);

            const yCtr = d3.scaleLinear()
                .domain([1.5, d3.max(data, d => d.ctr) * 1.1])
                .range([height, 0]);

            // Ejes
            const xAxis = g => g
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x).tickSize(0))
                .call(g => g.select(".domain").remove()); // Remover la línea del dominio
            
            const yRoasAxis = g => g
                .call(d3.axisLeft(yRoas).ticks(5).tickFormat(d3.format(".1f")))
                .call(g => g.select(".domain").remove())
                .call(g => g.selectAll(".tick line")
                    .attr("class", "grid")
                    .attr("x2", width));

            // Agregar Ejes
            svg.append("g").call(xAxis);
            svg.append("g").call(yRoasAxis);

            // Título Eje Y
            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .attr("class", "axis-title")
                .style("text-anchor", "middle")
                .style("fill", "#9CA3AF")
                .style("font-size", "10px")
                .text("ROAS");
            
            // Líneas
            const roasLine = d3.line()
                .x(d => x(`Semana ${d.week}`))
                .y(d => yRoas(d.roas))
                .curve(d3.curveMonotoneX);

            const ctrLine = d3.line()
                .x(d => x(`Semana ${d.week}`))
                .y(d => yCtr(d.ctr))
                .curve(d3.curveMonotoneX);

            // Path ROAS (verde)
            const pathRoas = svg.append("path")
                .datum(data)
                .attr("class", "line roas-line")
                .attr("d", roasLine);
            
            // Path CTR (azul)
            const pathCtr = svg.append("path")
                .datum(data)
                .attr("class", "line ctr-line")
                .attr("d", ctrLine);

            // Animación de la línea
            const totalLengthRoas = pathRoas.node().getTotalLength();
            pathRoas
                .attr("stroke-dasharray", totalLengthRoas + " " + totalLengthRoas)
                .attr("stroke-dashoffset", totalLengthRoas)
                .transition()
                .duration(2000)
                .ease(d3.easeLinear)
                .attr("stroke-dashoffset", 0);

            const totalLengthCtr = pathCtr.node().getTotalLength();
            pathCtr
                .attr("stroke-dasharray", totalLengthCtr + " " + totalLengthCtr)
                .attr("stroke-dashoffset", totalLengthCtr)
                .transition()
                .duration(2000)
                .delay(500) // Retraso para que inicie un poco después
                .ease(d3.easeLinear)
                .attr("stroke-dashoffset", 0);

            // Tooltip
            const tooltip = d3.select("#tooltip");

            // Círculos y Eventos de Interacción
            const lines = [
                { data: data, scale: yRoas, class: "roas-dot", color: "#10B981", name: "ROAS" },
                { data: data, scale: yCtr, class: "ctr-dot", color: "#3B82F6", name: "CTR" }
            ];

            lines.forEach(line => {
                svg.selectAll(`.${line.class}`)
                    .data(line.data)
                    .enter().append("circle")
                    .attr("class", line.class)
                    .attr("r", 6)
                    .attr("cx", d => x(`Semana ${d.week}`))
                    .attr("cy", d => line.scale(d[line.name.toLowerCase()]))
                    .style("fill", line.color)
                    .style("stroke", "#111827")
                    .style("stroke-width", 2)
                    .style("opacity", 0) // Inicia oculto
                    .transition()
                    .delay(2000) // Muestra después de la animación de línea
                    .duration(500)
                    .style("opacity", 1);

                svg.selectAll(`.${line.class}`)
                    .on("mouseover", function(event, d) {
                        d3.select(this).attr("r", 8).style("filter", "brightness(1.2)");
                        tooltip.html(`
                            <div class="font-bold text-xs mb-1">${line.name}: <span style="color:${line.color};">${d[line.name.toLowerCase()].toFixed(2)}</span></div>
                            <div class="text-xs text-slate-500">${d.label} (Semana ${d.week})</div>
                        `)
                        .style("opacity", 1)
                        .style("transform", "translateY(0)");
                    })
                    .on("mousemove", function(event) {
                        const [xPos, yPos] = d3.pointer(event, document.querySelector(containerId));
                        tooltip.style("left", (xPos + 10) + "px")
                               .style("top", (yPos - 10) + "px");
                    })
                    .on("mouseout", function() {
                        d3.select(this).attr("r", 6).style("filter", "none");
                        tooltip.style("opacity", 0)
                               .style("transform", "translateY(10px)");
                    });
            });
        }
        
        // --- INITIALIZATION ---
        window.onload = function() {
            initializeAuth(); // Iniciar Firebase Auth
            renderAvatars(); // Renderizar avatares en el estudio
            createD3Chart(); // Crear el gráfico D3

            // Escuchar el resize para actualizar el gráfico
            window.addEventListener('resize', createD3Chart); 
        };
    </script>
</body>
</html>

